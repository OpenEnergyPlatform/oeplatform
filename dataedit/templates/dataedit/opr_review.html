{% extends "dataedit/filter.html" %}
{% load static %}
{% load django_bootstrap5 %}

{% block after-head %}
<!-- <link href="/static/peer_review/peer_review.css" rel="stylesheet"> -->
{% endblock after-head %}


{% block site-header %}
{% endblock site-header %}

{% block main %}
<main class="main">
  <div class="main-header">
    <h1 class="main-header__title">
      <svg width="20" height="20" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M4.31781 2.68742C3.35608 3.12457 3 3.62628 3 4C3 4.37372 3.35608 4.87543 4.31781 5.31258C5.23441 5.72922 6.53579 6 8 6C9.46421 6 10.7656 5.72922 11.6822 5.31258C12.6439 4.87543 13 4.37372 13 4C13 3.62628 12.6439 3.12457 11.6822 2.68742C10.7656 2.27078 9.46421 2 8 2C6.53579 2 5.23441 2.27078 4.31781 2.68742ZM13 5.69813C12.729 5.90046 12.4201 6.07563 12.096 6.22295C11.022 6.71114 9.57336 7 8 7C6.42664 7 4.97802 6.71114 3.90401 6.22295C3.5799 6.07563 3.27105 5.90046 3 5.69813V7C3 7.37372 3.35608 7.87543 4.31781 8.31258C5.23441 8.72922 6.53579 9 8 9C9.46421 9 10.7656 8.72922 11.6822 8.31258C12.6439 7.87543 13 7.37372 13 7V5.69813ZM14 4C14 2.993 13.1249 2.24472 12.096 1.77705C11.022 1.28886 9.57336 1 8 1C6.42664 1 4.97802 1.28886 3.90401 1.77705C2.87513 2.24472 2 2.993 2 4V13C2 14.007 2.87513 14.7553 3.90401 15.2229C4.97802 15.7111 6.42664 16 8 16C9.57336 16 11.022 15.7111 12.096 15.2229C13.1249 14.7553 14 14.007 14 13V4ZM13 8.69813C12.729 8.90046 12.4201 9.07563 12.096 9.22295C11.022 9.71114 9.57336 10 8 10C6.42664 10 4.97802 9.71114 3.90401 9.22295C3.5799 9.07563 3.27105 8.90046 3 8.69813V10C3 10.3737 3.35608 10.8754 4.31781 11.3126C5.23441 11.7292 6.53579 12 8 12C9.46421 12 10.7656 11.7292 11.6822 11.3126C12.6439 10.8754 13 10.3737 13 10V8.69813ZM13 11.6981C12.729 11.9005 12.4201 12.0756 12.096 12.2229C11.022 12.7111 9.57336 13 8 13C6.42664 13 4.97802 12.7111 3.90401 12.2229C3.5799 12.0756 3.27105 11.9005 3 11.6981V13C3 13.3737 3.35608 13.8754 4.31781 14.3126C5.23441 14.7292 6.53579 15 8 15C9.46421 15 10.7656 14.7292 11.6822 14.3126C12.6439 13.8754 13 13.3737 13 13V11.6981Z" fill="#293B46"/>
      </svg>
      Database
    </h1>
    <div class="main-header__wizard">
      <span class="main-header__wizard-process">Review :</span>
      <span class="main-header__wizard-path"><a href="/dataedit/schemas">Topics</a> / <a href="/dataedit/view/model_draft">model_draft</a> / {{ table }}</span>
    </div>
  </div>
  <div class="fullwidth-tabs">
    <div class="fullwidth-tabs__container">
      <ul class="nav nav-tabs sticky-top" id="myTab" role="tablist">
        <li class="nav-item show active" role="presentation">
          <button class="nav-link active status status--done" id="general-tab" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab" aria-controls="general" aria-selected="true">General</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link status" id="spatiotemporal-tab" data-bs-toggle="tab" data-bs-target="#spatiotemporal" type="button" role="tab" aria-controls="spatiotemporal" aria-selected="false"> Spatiotemporal</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link status" id="source-tab" data-bs-toggle="tab" data-bs-target="#source" type="button" role="tab" aria-controls="source" aria-selected="false">Source</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link status status--done" id="license-tab" data-bs-toggle="tab" data-bs-target="#license" type="button" role="tab" aria-controls="license" aria-selected="false">License</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link status" id="contributor-tab" data-bs-toggle="tab" data-bs-target="#contributor" type="button" role="tab" aria-controls="contributor" aria-selected="false">Contributor</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link status" id="resource-tab" data-bs-toggle="tab" data-bs-target="#resource" type="button" role="tab" aria-controls="resource" aria-selected="false">Resource</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab" aria-controls="summary" aria-selected="false">Summary</button>
        </li>
      </ul>
    </div>
  </div>
  <div class="content">
    <div class="content__container">
      <div class="review">
        <div class="review__content">
          <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
              <div class="review__items">
                {% for item in meta.general %}
                <div id="field_{{item.field}}" class="field review__item" onclick="click_field('{{item.field}}', '{{ item.value }}', 'general');">
                  <p class="review__item-content">
                    {% if item.field is Null %}
                      <span class="key">{{item.field}}</span>
                      <span class="value">{{ item.value }}</span>
                    {% else %}
                      <span class="key">{{item.field}}</span>
                      <span class="value">{{ item.value }}</span>
                    {% endif %}
                  </p>
                </div>
                {% endfor %}
              </div>
            </div>
            <div class="tab-pane fade" id="spatiotemporal" role="tabpanel" aria-labelledby="spatiotemporal-tab">
              <div class="review__items">
                <p class="review__items-cat">Spatial</p>
                {% for item in meta.spatial %}
                <div id="field_{{item.field}}" class="field review__item" onclick="click_field('{{item.field}}', '{{ item.value }}', 'spatial');">
                  <p class="review__item-content">
                    <span class="key">{{item.field}}</span>
                    <span class="value">{{ item.value }}</span>
                  </p>
                </div>  
                {% endfor %}
                <p class="review__items-cat">Temporal</p>
                {% for item in meta.temporal %}
                <div id="field_{{item.field}}" class="field review__item" onclick="click_field('{{item.field}}', '{{ item.value }}', 'temporal');">
                  <p class="review__item-content">
                    {% if item.field is Null %}
                      <span class="key">{{item.field}}</span>
                      <span class="value">{{ item.value }}</span>
                    {% else %}
                      <span class="key">{{item.field}}</span>
                      <span class="value">{{ item.value }}</span>
                    {% endif %}
                  </p>
                </div>
                {% endfor %}
              </div>
            </div>
            <div class="tab-pane fade" id="source" role="tabpanel" aria-labelledby="source-tab">
              <div class="review__items">
              {% for item in meta.source %} 
                <div id="field_{{item.field}}" class="field review__item" onclick="click_field('{{item.field}}', '{{ item.value }}', 'source');">
                  <p class="review__item-content">
                    {% if item.field is Null %}
                      <span class="key">{{item.field}}</span>
                      <span class="value">{{ item.value }}</span>
                    {% else %}
                      <span class="key">{{item.field}}</span>
                      <span class="value">{{ item.value }}</span>
                    {% endif %}
                  </p>
                </div> 
              {% endfor %}
              </div>
            </div>
            <div class="tab-pane fade" id="license" role="tabpanel" aria-labelledby="license-tab">
              <div class="review__items">
              {% for item in meta.license %}
                <div id="field_{{item.field}}" class="field review__item" onclick="click_field('{{item.field}}', '{{ item.value }}', 'license');">
                  <p class="review__item-content">
                    <span class="key">{{item.field}}</span>
                    <span class="value">{{ item.value }}</span>
                  </p>
                </div>  
              {% endfor %}
              </div>
            </div>
            <div class="tab-pane fade" id="contributor" role="tabpanel" aria-labelledby="contributor-tab">
              <div class="review__items">
              {% for item in meta.contributor %}
                <div id="field_{{item.field}}" class="field review__item" onclick="click_field('{{item.field}}', '{{ item.value }}', 'contributor');">
                  <p class="review__item-content">
                    <span class="key">{{item.field}}</span>
                    <span class="value">{{ item.value }}</span>
                  </p>
                </div>  
              {% endfor %}
              </div>
            </div>
            <div class="tab-pane fade" id="resource" role="tabpanel" aria-labelledby="resource-tab">
              <div class="review__items">
                {% for item in meta.resource %}
                <div id="field_{{item.field}}" class="field review__item" onclick="click_field('{{item.field}}', '{{ item.value }}', 'resource');">
                  <p class="review__item-content">
                    <span class="key">{{item.field}}</span>
                    <span class="value">{{ item.value }}</span>
                  </p>
                </div>  
              {% endfor %}
              </div>
            </div>
            <div class="tab-pane fade" id="summary" role="tabpanel" aria-labelledby="summary-tab">
              <ul class="nav nav-tabs sticky-top" id="summarySubTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="#missingReviewSummaryTab" data-bs-toggle="tab" data-bs-target="#missingReviewSummaryTab" type="button" role="tab" aria-controls="missingReviewSummaryTab" aria-selected="true">Review missing</button>
                </li>
                  <li class="nav-item" role="presentation">
                  <button class="nav-link" id="#rejectedSummaryTab" data-bs-toggle="tab" data-bs-target="#rejectedSummaryTab" type="button" role="tab" aria-controls="rejectedSummaryTab" aria-selected="false">Rejected</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="#suggestionsSummaryTab" data-bs-toggle="tab" data-bs-target="#suggestionsSummaryTab" type="button" role="tab" aria-controls="suggestionsSummaryTab" aria-selected="true">Suggestions</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="#acceptedSummaryTab" data-bs-toggle="tab" data-bs-target="#acceptedSummaryTab" type="button" role="tab" aria-controls="acceptedSummaryTab" aria-selected="true">Accepted</button>
                </li>
              </ul>
            </div>
            <div class="tab-content">
              <div id="missingReviewSummaryTab" role="tabpanel" class="tab-pane fade">
                <i> Show missing review fields here.</i>
              </div>
              <div id="rejectedSummaryTab" role="tabpanel" class="tab-pane fade">
                <i> Show rejected fields here.</i>
              </div>
              <div id="suggestionsSummaryTab" role="tabpanel" class="tab-pane fade">
                <i> Show suggestion fields here.</i>
              </div>
              <div id="acceptedSummaryTab" role="tabpanel" class="tab-pane fade">
                <i> Show accepted fields here.</i>
              </div>
            </div>
          </div>
        </div>
        <div class="review__controls">
          <div class="review__box">
            <div id="field-descriptions-json" style="display: none;">
              {{ field_descriptions_json }}
            </div>
            <div class="review__btn-nav">
              <button type="button" onclick="selectPreviousField()">
                <span class="btn__icon">
                  <svg width="16" height="16" version="1.1" fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.35,0 L8.06,0.71 L1.41,7.35 L8.06,14 L7.35,14.71 L0,7.35 L7.35,0" />
                  </svg>
                </span>
              </button>
              <button type="button" onclick="selectNextField()">
                <span class="btn__icon">
                    <svg width="16" height="16" version="1.1" fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                      <path d="M5.35,15.35 L4.65,14.65 L11.29,8 L4.65,1.35 L5.35,0.65 L12.71,8 L5.35,15.35" />
                    </svg>
                </span>
              </button>
            </div>
            <div id="field-descriptions"></div>
            <div class="flex-reviewer" id="review-window">
              <h2 id="review-field-name" style="display:none"></h2>
              <div class="review__btns" role="group">
                <div class="review__btn review__btn--success">
                  <button type="button" id="ok-button" value="ok" onclick="selectState('ok');">Accept</button>
                </div>
                <div class="review__btn review__btn--suggested">
                  <button type="button" id="suggestion-button" value="suggestion" onclick="selectState('suggestion');">Suggest</button>
                </div>
                <div class="review__btn review__btn--denied">
                  <button type="button" id="rejected-button" value= "rejected" onclick="selectState('rejected');">Deny</button>
                </div>
              </div>
              <div class="d-none review__remarks" id="reviewer_remarks">
                <div class="review__field" id="field-value">
                  <label for="valuearea" class="form-label">Your value suggestion</label>
                  <textarea class="form-control" id="valuearea" rows="2" ></textarea>
                </div>
                <div class="review__field review__field--nolabel" id="field-comment">
                  <label for="commentarea" class="form-label"></label>
                  <textarea class="form-control" id="commentarea" rows="2" placeholder="Comment here if you want to explain your suggestion" ></textarea>
                </div>
                <button type="button" class="btn btn-warning review__field-save" id="submitButton">Save comment/new value</button>
              </div>
            </div>
          </div>
          <div class="review__save-btns" id="peer_review-controls">
            <div class="review__save-btn review__save-btn--save">
              <span class="" {% if not can_add %} data-toggle="tooltip" title="You need write permissions on this table to upload meta data" {% endif %}>
                <a href="#peer_review-submit" class="{% if not can_add %} disabled {% endif %}" id="peer_review-submit">
                  <span class="spinner-border text-light d-none spinner-border-sm" id="peer_review-submitting">
                  </span>Save Review Progress
                </a>
              </span>
            </div>
            <div class="review__save-btn review__save-btn--summary">
              <button id="submit_summary">Submit summary</button>
            </div>
            <div class="review__save-btn review__save-btn--quit">
              <button id="peer_review-cancel">Quit</button>
            </div>
          </div>
          <div class="review__infos">
            <div>Dataset uploaded by <a href="#">bmlancien</a> on <span class="review__infos--date">2022-09-19</span></div>
            <div><span class="review__infos--review-number">0</span> review</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>




{% endblock main %}


{% block after-body-bottom-js %}
  <script>
  const fieldDescriptionsData = JSON.parse(document.getElementById("field-descriptions-json").textContent);
    var config = JSON.parse("{{ config|escapejs }}");
  </script>
  <script src="/static/peer_review/opr_reviewer.js"></script>
{% endblock after-body-bottom-js %}

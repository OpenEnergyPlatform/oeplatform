{% extends "dataedit/base.html" %}


{% block main-right-sidebar-filter %}
<!-- extending the filter block to add wizard button -->

<h3>Create Table</h3>
<a class="btn btn-success" href="{% url 'wizard_create' %}">
    Create new table
</a> in the <a href="{% url 'input' 'model_draft' %}">model_draft</a> schema.
<hr>
<div style="display: flex;">
    <h3>Search & filter</h3>
    <button type="button" 
    class="btn btn-outline-light" 
    data-toggle="popover" 
    data-trigger="focus" 
    title="How to use search and filter" 
    {% if not tables%}
    data-content="Use the Filters on Tags or try searching for text that may occur in table names or in metadata. If you filter for multiple Tags, only schemas containing tables with all filtered Tags will be displayed. To see all schemas and tables again use the reset filter button." 
    {% else %}
    data-content="Use the Filters on Tags or try searching for text that may occur in table names or in metadata."
    {% endif %}
    style="margin-left: 10px;">
        <i class="fas fa-info-circle" style="color: #3B77A0;"></i>
    </button>
</div>
<form action="{{ request.path }}" method="get">
    <h5>Text</h5>
    <div class="searchbox_container small">
        <input type="text" name="query" placeholder="Search" value="{% firstof query '' %}" class="form-control" />
    </div>
    {% load dataedit.taghandler %}
    {% get_tags None None None as all_tags %}
    <h5>Tags</h5>    
    <div id="tags">
        <div style="display: flex; flex-flow: wrap; margin-bottom: 1em;">
            <select name="tags" class="form-control selectpicker" multiple data-live-search="true"
                title="Click and search all Tags..." data-style="btn-outline-primary" data-width="auto" data-selected-text-format="values" data-actions-box="true" iconBase="fa">
                {% for t in all_tags %}
                <option data-content='<i class="fa fa-circle" style="color: {{t.color}};"></i> {{ t.name }}' value="{{ t.id }}" {% if t.id in tags %}selected{% endif %}>
                    {{ t.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div style="padding-bottom: 15px;">
            <button type="submit" class="btn btn-success">
                Apply Filters
            </button>
            <a class="btn btn-danger" href="{{ request.path }}">
                Reset Filters
            </a>
        </div>
    </div>
</form>
{% endblock main-right-sidebar-filter %}

{% block after-body-bottom-js %}
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.0/dist/css/bootstrap-select.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.0/dist/js/bootstrap-select.min.js"></script>
<script>
    $('[data-toggle="popover"]').popover({html:true})
    .on("focus", function () {
        $(this).popover("show");
    }).on("focusout", function () {
        var _this = this;
        if (!$(".popover:hover").length) {
            $(this).popover("hide");
        }
        else {
            $('.popover').mouseleave(function() {
                $(_this).popover("hide");
                $(this).off('mouseleave');
            });
        }
    })
</script>
{% endblock after-body-bottom-js %}
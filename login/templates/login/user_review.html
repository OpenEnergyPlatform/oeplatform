{% extends "base/base-profile.html" %}
{% load django_bootstrap5 %}
{% load static %}


{% block main-right-sidebar-content %}
{% if profile_user == request.user %}
<div class="profile-sidebar">
    <div class="profile-sidebar__img">
        {% if profile_user.profile_img %}
        <img class="rounded-circle account-img" src="{{ profile_user.profile_img.url }}" width="200" height="200" alt="Profile picture">
        {% else %}
        <svg width="100" height="100" fill="currentColor" version="1.1" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <g>
                <path d="m90.469 80.945v-9.5234h-4.7617v-4.7617h-4.7617v-4.7617h-4.7617v-4.7773h-14.285v4.7773h-9.5234v0.019531h-14.297v-4.7773h-14.285v4.7773h-4.7617v4.7617h-4.7617v4.7617h-4.7617v9.5234l-4.7461-0.003906v14.293h47.652v-0.019531h42.848v-14.293zm0 9.5195h-38.094v0.019531h-42.867v-4.7617h4.7617v-9.5234h4.7617v-4.7617h4.7617v-4.7617h4.7617v-4.7617h4.7617v4.7617h19.074v-0.019531h14.27v-4.7617h4.7617v4.7617h4.7617v4.7617h4.7617v4.7617h4.7617v9.5234h4.7617z"/>
                <path d="m71.43 19.027v-4.7617h-4.7617v-4.7617h-4.7617v-4.7539h-9.5234v0.019531h-14.312v4.7617h-4.7617v4.7617h-4.7617v4.7617h-4.7617v19.047h4.7617v4.7617h4.7617v4.7617h4.7617v4.7695h14.312v-0.019531h9.5234v-4.7695h4.7617v-4.7617h4.7617v-4.7617h4.7617v-19.047l-4.7617-0.003906zm0 9.5234v4.7617h-4.7617v4.7617h-4.7617v4.7617h-4.7617v4.7617h-4.7617v0.019532h-9.5508v-4.7617h-4.7617v-4.7617h-4.7617v-4.7617h-4.7617v-9.5234h4.7617v-4.7617h4.7617v-4.7617h4.7617v-4.7617h9.5508l0.003907-0.015626h4.7617v4.7617h4.7617v4.7617h4.7617v4.7617h4.7617z"/>
            </g>
        </svg>
    {% endif %}
    </div>
    <div class="profile-sidebar__block">
        <p class="profile-sidebar__name">{{ profile_user.name }}</p>
        <div>
            {% if profile_user.fullname %}
                {{ profile_user.fullname }}
            {% else %}
                <p>Full Name</p>
            {% endif %} 
        </div>
        <p>Member since {{ profile_user.registration_date|date:"d/m/Y" }}</p>
    </div>
    <div class="profile-sidebar__block">
        <div>{% if profile_user.work %}
            <p>{{ profile_user.work }}</p>
        {% else %}
            <p>Profession</p>
        {% endif %} 
        </div>
        <div>{% if profile_user.location %}
            <p>{{ profile_user.location }}</p>
        {% else %}
            <p>Location</p>
        {% endif %} 
        </div>
        <div> {% if profile_user.email %}
            <p>{{ profile_user.email }}</p>
            {% endif %}
            <p> {% if profile_user.linkedin %}
                <a href="{{ profile_user.linkedin }}">{{ profile_user.linkedin }}</a>
                {% else %}
                    LinkedIn
                {% endif %} </p>
            <p> {% if profile_user.facebook %}
                <a target="_blank" href="{{ profile_user.facebook }}">{{ profile_user.facebook }}</a>
                {% else %}
                    Facebook
                {% endif %} </p>
            <p> {% if profile_user.twitter %}
                <a href="{{ profile_user.twitter }}">{{ profile_user.twitter }}</a>
                {% else %}
                    Twitter
                {% endif %} </p>
        </div>
    </div>
</div>
    
    {% endif %}
{% endblock %}

{% block main-content-body %}
{% if profile_user == request.user %}
{% include "login/user_nav.html" %}
    <h2 class="header">Active Open Peer Reviews</h2>
    <p> 
        This section lists the latest active reviews in which you are currently participating as a reviewer or data contributor.
    </p>
    {% if reviewer_reviewed.latest is not None %}
        {% if reviewer_reviewed.current_reviewer == "reviewer" and reviewer_reviewed.latest_status != "FINISHED" %}
            <div class="profile-rvw">
                <!-- placeholder css class for contributor `profile-rvw__item--reviewer` -->
                <div class="profile-rvw__item profile-rvw__item--highlight profile-rvw__item--reviewer">
                    <div class="profile-rvw__item-top">
                        <div class="profile-rvw__item-left">
                            <!-- placeholder type: contributor or reviewer -->
                            <div class="profile-rvw__item-type">Participating as Reviewer</div>
                            <!-- placeholder status: saved, submitted, finished -->
                            <div class="profile-rvw__item-status">{{ reviewer_reviewed.latest_status }}</div>
                        </div>
                        <div class="profile-rvw__item-right">
                            <!-- placeholder open: day number -->
                            <div class="profile-rvw__item-days">Open {{ reviewer_reviewed.latest_days_open }} days ago</div>
                            <div>&nbsp—&nbsp</div>
                            <!-- placeholder date -->
                            <div class="profile-rvw__item-date">Started on {{ reviewer_reviewed.latest.date_started }}</div>
                        </div>
                    </div>
                    <div class="profile-rvw__item-btm">
                        <!-- placeholder table name -->
                        <div class="profile-rvw__item-name">
                            <a href="{% url 'peer_review_reviewer' reviewer_reviewed.latest.schema reviewer_reviewed.latest.table reviewer_reviewed.latest.id %}" class="btn btn-primary">
                                {{ reviewer_reviewed.latest.schema }} - {{ reviewer_reviewed.latest.table }} 
                            </a>
                        </div>
                        <div class="profile-rvw__item-history">
                            <button type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false" disabled>
                                Show history
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton1">
                                <li><a class="dropdown-item" href="#">Action</a></li>
                                <li><a class="dropdown-item" href="#">Another action</a></li>
                                <li><a class="dropdown-item" href="#">Something else here</a></li>
                            </ul>
                        </div>
                    </div>
                </div>


                
        {% elif reviewer_reviewed.latest_status == "FINISHED" %}
        <div class="profile-rvw__item profile-rvw__item--highlight profile-rvw__item--reviewer">
            <ul class="profile-rvw__list">
                <li>
                    No active reviews where you participate as a reviewer.
                </li>
            </ul>
        </div>
        {% else %}
        <div class="profile-rvw__item profile-rvw__item--highlight profile-rvw__item--reviewer">
            <ul class="profile-rvw__list">
                <li>
                    <span>{{ reviewer_reviewed.latest.schema }} - {{ reviewer_reviewed.latest.table }}</span> waits for the contributor to submit the review.
                </li>
            </ul>
        </div>
        {% endif %}
    {% endif %}

    {% if contributor_reviewed.latest is not None %}
        {% if contributor_reviewed.current_reviewer == "contributor" and contributor_reviewed.latest_status != "FINISHED" %}  
         <!-- placeholder css class for contributor `profile-rvw__item--contributor` -->
         <div class="profile-rvw__item profile-rvw__item--highlight profile-rvw__item--contributor">
            <div class="profile-rvw__item-top">
                <div class="profile-rvw__item-left">
                    <!-- placeholder type: contributor or reviewer -->
                    <div class="profile-rvw__item-type">Participating as data contributor</div>
                    <!-- placeholder status: saved, done, etc -->
                    <div class="profile-rvw__item-status">{{ contributor_reviewed.latest_status }}</div>
                </div>
                <div class="profile-rvw__item-right">
                    <!-- placeholder open: day number -->
                    <div class="profile-rvw__item-days">Open {{ contributor_reviewed.latest_days_open }} days ago</div>
                    <div>&nbsp—&nbsp</div>
                    <!-- placeholder date -->
                    <div class="profile-rvw__item-date">Started on {{ contributor_reviewed.latest.date_started }}</div>
                </div>
            </div>
            <div class="profile-rvw__item-btm">
                <!-- placeholder table name -->
                <div class="button profile-rvw__item-name">
                    <a href="{% url 'peer_review_contributor' contributor_reviewed.latest.schema contributor_reviewed.latest.table contributor_reviewed.latest.id %}" class="btn btn-primary">
                        {{ contributor_reviewed.latest.schema }} - {{ contributor_reviewed.latest.table }}  
                    </a>
                </div>
                <div class="profile-rvw__item-history">
                    <button type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false" disabled>
                        Show history
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton2">
                        <li><a class="dropdown-item" href="#">Action</a></li>
                        <li><a class="dropdown-item" href="#">Another action</a></li>
                        <li><a class="dropdown-item" href="#">Something else here</a></li>
                    </ul>
                </div>
            </div>
        </div>
        {% elif contributor_reviewed.latest_status == "FINISHED" %}
        <div class="profile-rvw__item profile-rvw__item--highlight profile-rvw__item--contributor">
            <ul class="profile-rvw__list">
                <li>
                    No active reviews where you participate as a data contributor.
                </li>
            </ul>
        </div>
        {% else %}
        <div class="profile-rvw__item profile-rvw__item--highlight profile-rvw__item--contributor">
            <ul class="profile-rvw__list">
                <li>
                    <span>{{ contributor_reviewed.latest.schema }} - {{ contributor_reviewed.latest.table }}</span> waits for the reviewer to submit the review.
                </li>
            </ul>
        </div>
        {% endif %}
    {% endif %}

        <h2 class="header">All reviews</h2>
        <p> 
            This section lists all available reviews. 
        </p>

        {% if reviewer_reviewed.latest is not None %}
        {% for table_name, reviews in reviewer_reviewed_grouped.items %}
            
        {% for review in reviews %}
        {% if forloop.first %}
            <!-- Display the latest review separately -->
            <!-- <li> -->
            
            <!-- <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseReviewHistory{{table_name}}" aria-expanded="false" aria-controls="collapseReviewHistory{{table_name}}">
            Show review history 
            </button> -->
            <!-- </li> -->
            <!-- placeholder css class for reviewer completed -->
            <div class="profile-rvw__item profile-rvw__item--done profile-rvw__item--reviewer">
                <div class="profile-rvw__item-top">
                    <div class="profile-rvw__item-left">
                        <!-- placeholder type: contributor or reviewer -->
                        <div class="profile-rvw__item-type">Participated as Reviewer</div>
                        <!-- placeholder status: saved, submitted, finished -->
                        <div class="profile-rvw__item-status profile-rvw__item-status--done">{% if review.is_finished == True %} Completed {% else %} Ongoing {% endif %}</div>
                    </div>
                    <div class="profile-rvw__item-right">
                        <!-- placeholder open: day number -->
                        <!-- <div class="profile-rvw__item-days">Open ___ days ago</div>
                        <div>&nbsp—&nbsp</div> -->
                        <!-- placeholder date -->
                        {% if review.is_finished == False %}
                        <div class="profile-rvw__item-date">Started on {{ review.date_started }}</div>
                        {% else %}
                        <!-- placeholder date -->
                        <div class="profile-rvw__item-date">Finished on {{ review.date_finished }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="profile-rvw__item-btm">
                    <!-- placeholder table name -->
                    <div class="profile-rvw__item-name">
                        <a href="/dataedit/view/{{ review.schema }}/{{ review.table }}">{{ review.schema }} - {{ review.table }}</a>
                    </div>
                </div>
            </div>
        {% endif %}
        {% endfor %}
        
        <div class="collapse" id="collapseReviewHistory{{table_name}}">
            <div class="card card-body">
                <p> History </p>
                <ul>
                    {% for review in reviews %}
                    <!-- Display other reviews normally -->
                    <li>{{ review.id }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endfor %}
    {% else %}
        <ul>
            <li>
                No reviews found for this User.
            </li>
        </ul>
    {% endif %}
        
    {% if contributor_reviewed.latest is not None %}
    
    {% for table_name, reviews in contributor_reviewed_grouped.items %}

    {% for review in reviews %}
    {% if forloop.first %}

        <!-- placeholder css class for contributor completed -->
        <div class="profile-rvw__item profile-rvw__item--done profile-rvw__item--contributor">
            <div class="profile-rvw__item-top">
                <div class="profile-rvw__item-left">
                    <!-- placeholder type: contributor or reviewer -->
                    <div class="profile-rvw__item-type">Participated as Contributor</div>
                    <!-- placeholder status: saved, submitted, finished -->
                    <div class="profile-rvw__item-status profile-rvw__item-status--done">{% if review.is_finished == True %} Completed {% else %} Ongoing {% endif %}</div>
                </div>
                <div class="profile-rvw__item-right">
                    <!-- placeholder open: day number -->
                    <!-- <div class="profile-rvw__item-days">Open {{ reviewer_reviewed.latest_days_open }} days ago</div>
                    <div>&nbsp—&nbsp</div> -->
                    {% if review.is_finished == False %}
                    <!-- placeholder date -->
                    <div class="profile-rvw__item-date">Started on {{ review.date_started }}</div>
                    {% else %}
                    <!-- placeholder date -->
                    <div class="profile-rvw__item-date">Finished on {{ review.date_finished }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="profile-rvw__item-btm">
                <!-- placeholder table name -->
                <div class="profile-rvw__item-name">
                    <a href="/dataedit/view/{{ review.schema }}/{{ review.table }}">{{ review.schema }} - {{ review.table }}</a>
                </div>
            </div>
        </div>
        
        <!-- <li>
            
            <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseContribHistory{{table_name}}" aria-expanded="false" aria-controls="collapseContribHistory{{table_name}}">
            Show review history 
            </button>
        </li> -->
    {% endif %}
    {% endfor %}
        <div class="collapse" id="collapseContribHistory{{table_name}}">
            <div class="card card-body">
                <p> History </p>
                <ul>
                    {% for review in reviews %}
                    <!-- Display other reviews normally -->
                    <li>{{ review.id }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endfor %}
        {% else %}
    <ul>
        <li>
            No contributions found for this User.
        </li>
    </ul>
        {% endif %}
    
</div>
{% endif %}
{% endblock %}
{% extends "modelview/detail_view.html" %}
{% load django_bootstrap5 %}
{% load static %}
{% load modelview_extras %}

{% block after-head %}
  <link rel="stylesheet" href="{% static 'css/mv-style.css' %}">
  <link rel="stylesheet" href="{% static 'css/custom_alert.css' %}">
  <script type="text/javascript" src="/recline/vendor/jquery/1.7.1/jquery.js"></script>
{% endblock after-head %}

{% block main-right-sidebar-content-actions %}
{% endblock main-right-sidebar-content-actions %}

{% block factsheets_content %}

<script>
  const csrftoken_add_study = getCookie('csrftoken');

  function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              // Does this cookie string begin with the name we want?
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }


  function createNewStudy() {


    const addNewItem = {
      add: async () => createAddNewItem()
    }

    const createAddNewItem = () => {
      return new Promise((complete, failed)=>{
        $('#add_study').off('click');
        $('#add_study').on('click', ()=> { $('.add_new_entry').hide(); complete(true); });
        $('.add_new_entry').show();
      });
    }

    const addItem = async () => {
      const confirm = await addNewItem.add();

      if(confirm){
        const new_name = document.getElementById("new_study_name").value.replaceAll(" ", "_");
        console.log(new_name);
        $.post("/factsheets/rdf/study/new/",
            {
                query: JSON.stringify({ property: new_name }),
                csrfmiddlewaretoken: csrftoken_add_study
            },
            function (result) {
              console.log(result);
            })
        window.location.reload();
      }
    }

    addItem();


  }

</script>

<div  class="list-group">
  <div style="border: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; background-color: rgb(161 214 251 / 22%); height: 50px">
    <span style="margin-left: 10px; font-weight: bold; font-size: 22px;""> Study factsheets </span>
    <span style="margin-right: 10px" type="button" class="fas fa-lg fa-folder-plus" onClick="createNewStudy()"></span>
  </div>
  {% for inst in instances %}
    <a class="list-group-item list-group-item-action" href="{{ inst.element }}" >{{ inst.label }}</a>
  {% endfor %}
</div>

<div class="add_new_entry">
  <div  style="background-color: #eaf6fe;">
    <div><i class="fa fa-plus-circle fa-2x" aria-hidden="true"></i></div>
    <div style="margin: 15px;">Please enter a name for this new entry:</div>
    <div>
      <input id="new_study_name" class="form-control" type="text" placeholder="">
      <input id="add_study" type="button" value="Submit" class="ok_button"  />
    </div>
  </div>
</div>




{% endblock factsheets_content %}

FROM node:18

WORKDIR /home/appuser/app

# copy package manifests so entrypoint can npm ci
COPY package*.json ./
RUN npm ci

# drop in our install-if-missing entrypoint
COPY docker/vite-entrypoint.sh /usr/local/bin/vite-entrypoint.sh
RUN chmod +x /usr/local/bin/vite-entrypoint.sh

# expose dev port
EXPOSE 5173

# first runs entrypoint, then runs 'npm run dev'
ENTRYPOINT [ "vite-entrypoint.sh" ]
CMD       [ "npm", "run", "dev", "--", "--host", "0.0.0.0" ]
